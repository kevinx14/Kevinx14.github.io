<main class="main post-page">
    <article class="article-entry">
        <h2 id="1-centos7最小化安装"><a href="#1-centos7最小化安装" class="headerlink" title="1. centos7最小化安装"></a>1. centos7最小化安装</h2><p><a href="http://www.cnosx.com/2017/09/06/centos7最小化安装/">http://www.cnosx.com/2017/09/06/centos7最小化安装/</a></p>
<h2 id="2-安装图形界面及管理工具"><a href="#2-安装图形界面及管理工具" class="headerlink" title="2. 安装图形界面及管理工具"></a>2. 安装图形界面及管理工具</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#安装图形界面</div><div class="line">yum -y groupinstall &quot;GNOME Desktop&quot; &quot;Graphical Administration Tools&quot;</div><div class="line">#开机进入图形界面</div><div class="line">ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target</div><div class="line">#重启</div><div class="line">reboot</div></pre></td></tr></table></figure>
<h2 id="3-安装tigervnc"><a href="#3-安装tigervnc" class="headerlink" title="3. 安装tigervnc"></a>3. 安装tigervnc</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#安装tigervnc</div><div class="line">yum -y install tigervnc*</div><div class="line">#复制vncserver服务文件</div><div class="line">cp /lib/systemd/system/vncserver@.service /lib/systemd/system/vncserver@:4.service</div><div class="line">#编辑文件</div><div class="line">vim /lib/systemd/system/vncserver@:4.service</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#vncserver@:4.service内容</div><div class="line">[Unit]</div><div class="line">Description=Remote desktop service (VNC)</div><div class="line">After=syslog.target network.target</div><div class="line"></div><div class="line">[Service]</div><div class="line">Type=forking</div><div class="line"># Clean any existing files in /tmp/.X11-unix environment</div><div class="line">ExecStartPre=/bin/sh -c &apos;/usr/bin/vncserver -kill :4 &gt; /dev/null 2&gt;&amp;1 || :&apos;</div><div class="line">ExecStart=/sbin/runuser -l root -c &quot;/usr/bin/vncserver :4&quot;</div><div class="line">PIDFile=/root/.vnc/%H%i.pid</div><div class="line">ExecStop=/bin/sh -c &apos;/usr/bin/vncserver -kill :4 &gt; /dev/null 2&gt;&amp;1 || :&apos;</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure>
<h2 id="4-设置开机启动vncserver-4-service"><a href="#4-设置开机启动vncserver-4-service" class="headerlink" title="4. 设置开机启动vncserver@:4.service"></a>4. 设置开机启动vncserver@:4.service</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#启动</div><div class="line">systemctl start vncserver@:4.service</div><div class="line">#开机启动</div><div class="line">systemctl enable vncserver@:4.service</div><div class="line">#查看启动状态</div><div class="line">systemctl status vncserver@:4.service</div><div class="line">#停止</div><div class="line">systemctl stop vncserver@:4.service</div><div class="line">#取消开机启动</div><div class="line">systemctl disable vncserver@:4.service</div><div class="line">#更新systemctl，使刚才的修改生效</div><div class="line">systemctl daemon-reload</div></pre></td></tr></table></figure>
<h2 id="5-关闭selinux"><a href="#5-关闭selinux" class="headerlink" title="5. 关闭selinux"></a>5. 关闭selinux</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#临时关闭</div><div class="line">setenforce 0</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#编辑selinx</div><div class="line">vim /etc/sysconfig/selinux</div></pre></td></tr></table></figure>
<p>将<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELINUX=enforcing</div></pre></td></tr></table></figure></p>
<p>修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELINUX=disabled</div></pre></td></tr></table></figure></p>
<h2 id="6-防火墙放行端口"><a href="#6-防火墙放行端口" class="headerlink" title="6. 防火墙放行端口"></a>6. 防火墙放行端口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#放行5900-5903端口</div><div class="line">firewall-cmd --permanent --add-service vnc-server</div><div class="line">#放行5904-5910端口</div><div class="line">firewall-cmd --add-port=5904:5910/tcp --permanent</div><div class="line">#删除放行5900-5903端口</div><div class="line">firewall-cmd --permanent --remove-service vnc-server</div><div class="line">#重启防火墙</div><div class="line">systemctl restart firewalld.service</div><div class="line">#查看防火墙配置</div><div class="line">iptables -L -n</div></pre></td></tr></table></figure>
<h2 id="7-安装KVM所需软件"><a href="#7-安装KVM所需软件" class="headerlink" title="7. 安装KVM所需软件"></a>7. 安装KVM所需软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#安装KVM所需软件</div><div class="line">yum -y install kvm kmod-kvm kvm-qemu-img libvirt Python-virtinst virt-manager virt-top virt-viewer libvirt-client qemu-kvm bridge-utils virt-install</div><div class="line">#查看KVM是否启动</div><div class="line">lsmod | grep kvm</div></pre></td></tr></table></figure>
<h2 id="8-配置网络"><a href="#8-配置网络" class="headerlink" title="8. 配置网络"></a>8. 配置网络</h2><p>配置br0虚拟网卡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#新建br0</div><div class="line">vim /etc/sysconfig/network-scripts/ifcfg-br0</div></pre></td></tr></table></figure></p>
<p>DHCP获取IP（二选一）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">DEVICE=br0</div><div class="line">TYPE=Bridge</div><div class="line">ONBOOT=yes</div><div class="line">NM_CONTROLLED=no</div><div class="line">BOOTPROTO=dhcp</div></pre></td></tr></table></figure></p>
<p>手动配置ip（二选一）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">BOOTPROTO=static</div><div class="line">DEVICE=br0</div><div class="line">TYPE=Bridge</div><div class="line">NM_CONTROLLED=no</div><div class="line">IPADDR=192.168.1.2</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=192.168.1.1</div><div class="line">DNS1=223.5.5.5</div><div class="line">DNS2=223.6.6.6</div></pre></td></tr></table></figure></p>
<p>桥接物理网卡至br0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#编辑物理网卡enp3s0（注意centos7后网卡命名有新的规则，不一定是enp3s0，请按实际情况修改）</div><div class="line">vim /etc/sysconfig/network-scripts/ifcfg-enp3s0</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#网卡文件内容</div><div class="line">DEVICE=enp3s0</div><div class="line">TYPE=Ethernet</div><div class="line">ONBOOT=yes</div><div class="line">NM_CONTROLLED=no</div><div class="line">BOOTPROTO=none</div><div class="line">BRIDGE=&quot;br0&quot;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#重启网络</div><div class="line">systemctl restart network</div></pre></td></tr></table></figure>
<h2 id="9-新建虚拟磁盘存放文件夹"><a href="#9-新建虚拟磁盘存放文件夹" class="headerlink" title="9. 新建虚拟磁盘存放文件夹"></a>9. 新建虚拟磁盘存放文件夹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#查看分区空间</div><div class="line">df -h</div><div class="line">#新建文件夹</div><div class="line">mkdir /home/kvm-img</div><div class="line">#修为文件夹权限</div><div class="line">chmod 777 /home/kvm-img/</div></pre></td></tr></table></figure>
<h2 id="10-新建虚拟并安装win7"><a href="#10-新建虚拟并安装win7" class="headerlink" title="10. 新建虚拟并安装win7"></a>10. 新建虚拟并安装win7</h2><p>下载win7iso文件或使用scp从别的服务器拷贝<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">virt-install --name=win7 --ram 2045 --vcpus=2 \</div><div class="line">--cdrom /home/kvm-img/win7.iso \</div><div class="line">--disk path=/home/kvm-img/7.img,size=40,format=qcow2 \</div><div class="line">--network bridge=br0 \</div><div class="line">--graphics vnc,listen=0.0.0.0,port=5910,password=123456</div></pre></td></tr></table></figure></p>
<h2 id="11-通过vnc客户端链接完成安装"><a href="#11-通过vnc客户端链接完成安装" class="headerlink" title="11. 通过vnc客户端链接完成安装"></a>11. 通过vnc客户端链接完成安装</h2><p>使用ip端口<br>192.168.1.2:5910<br>密码<br>123456</p>

    </article>
    <!-- 前后页  -->
    <ul class="post-pager">
        
        
            <li class="previous">
                <a href= "/2017/09/06/centos7最小化安装/" title= centos7最小化安装 >
                    <span>Previous Post</span>
                    <span>centos7最小化安装</span>
                </a>
            </li>
        
    </ul>
    <!-- 来必力City版安装代码 -->

    
    <div id="lv-container" data-id="city" data-uid= MTAyMC8zMDk2MC83NTA5>
        <script type="text/javascript">
            (function (d, s) {
                var j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') { return; }
                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    </div>
    

<!-- City版安装代码已完成 -->
</main>